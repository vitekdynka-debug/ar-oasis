<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WebAR Demo — Sketchfab_Scene.glb</title>

    <!-- Load <model-viewer> (ES module) -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

    <!-- Basic page styles -->
    <style>
      :root {
        --bg: #0b0c10;
        --fg: #e8e8e8;
        --accent: #4cc9f0;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; margin: 0; }
      body {
        background: var(--bg);
        color: var(--fg);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        display: grid;
        grid-template-rows: auto 1fr auto;
      }
      header, footer { padding: 0.75rem 1rem; }
      header { display: flex; align-items: center; gap: 0.5rem; }
      header h1 { font-size: 1rem; margin: 0; font-weight: 600; opacity: .9; }
      header .dot { width: .5rem; height: .5rem; border-radius: 999px; background: var(--accent); display:inline-block; }

      /* Model viewer fills the viewport area */
      .stage { position: relative; min-height: 60vh; }
      model-viewer {
        width: 100%;
        height: calc(100vh - 110px);
        background: radial-gradient(1200px 400px at 50% 120%, rgba(76,201,240,.15), transparent 60%);
        --poster-color: #0b0c10;
      }

      /* Overlay hint for AR */
      .hint {
        position: absolute; left: 50%; bottom: 18px; transform: translateX(-50%);
        background: rgba(20,20,25,.7); color: #fff; backdrop-filter: blur(6px);
        border: 1px solid rgba(255,255,255,.1);
        border-radius: 999px; padding: .5rem .9rem; font-size: .9rem;
      }

      a.btn { color: var(--bg); background: var(--accent); text-decoration: none; padding: .45rem .7rem; border-radius: 8px; font-weight: 600; }
      .row { display: flex; gap: .5rem; align-items: center; }

      footer { opacity: .7; font-size: .8rem; display:flex; justify-content: space-between; align-items:center; }
      code { background: #11131a; color: #bfe8ff; padding: .15rem .35rem; border-radius: 4px; }

      @media (max-width: 640px) {
        model-viewer { height: calc(100vh - 140px); }
      }
    </style>
  </head>
  <body>
    <header>
      <span class="dot"></span>
      <h1>WebAR Demo</h1>
      <div class="row" style="margin-left:auto">
        <!-- Optional: link to open same page for QR sharing -->
        <a class="btn" id="shareBtn" href="#">Share</a>
      </div>
    </header>

    <div class="stage">
      <!--
        Place your GLB file in the SAME folder as this index.html.
        File name expected: Sketchfab_Scene.glb (you can change src if needed).

        Notes:
        - ar-modes includes webxr, scene-viewer (Android), quick-look (iOS with USDZ).
        - If you have a USDZ for iOS, set ios-src to that file (e.g., ios-src="model.usdz").
        - ar-placement="floor" requests ground-anchored placement.
      -->
      <model-viewer
        id="viewer"
        src="./Sketchfab_Scene.glb"
        alt="3D model"
        ar
        ar-modes="webxr scene-viewer quick-look"
        ar-placement="floor"
        camera-controls
        touch-action="pan-y"
        orientation="landscape"
        shadow-intensity="1"
        exposure="1"
        auto-rotate
        autoplay
        environment-image="neutral"
        poster=""
        loading="eager">

        <!-- Built-in AR button (auto-shown when supported) -->
        <button slot="ar-button" class="ar-button">View in AR</button>

        <!-- A simple loading bar -->
        <div slot="progress-bar" class="progress-bar" style="display: none;">
          <div class="update-bar"></div>
        </div>
      </model-viewer>

      <div class="hint">Tap the AR button to place the model on the floor</div>
    </div>

    <footer>
      <div>
        <strong>How to host:</strong> Put <code>index.html</code> + <code>Sketchfab_Scene.glb</code> in your repo root → GitHub Pages.
      </div>
      <div id="status"></div>
    </footer>

    <!-- Minimal styles for built-in slots -->
    <style>
      .ar-button {
        position: absolute; left: 50%; bottom: 64px; transform: translateX(-50%);
        font-size: 16px; line-height: 1; font-weight: 700;
        background: var(--accent); color: var(--bg);
        border: 0; border-radius: 999px; padding: 12px 18px; cursor: pointer;
        box-shadow: 0 10px 18px rgba(0,0,0,.25);
      }

      .progress-bar { position: absolute; left: 50%; top: 16px; transform: translateX(-50%); width: 240px; height: 6px; background: rgba(255,255,255,.12); border-radius: 999px; overflow: hidden; }
      .progress-bar .update-bar { width: 0; height: 100%; background: var(--accent); }
    </style>

    <!-- Small helper script: progress bar + share link -->
    <script>
      const viewer = document.getElementById('viewer');
      const progress = document.querySelector('.progress-bar');
      const bar = document.querySelector('.update-bar');
      const status = document.getElementById('status');

      // Update loading progress
      viewer.addEventListener('progress', (event) => {
        const total = event.totalProgress || 0;
        progress.style.display = total < 1 ? 'block' : 'none';
        bar.style.width = `${Math.round(total * 100)}%`;
      });

      // Feature detection + status
      function supportsAR() {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const hasUSDZ = !!viewer.getAttribute('ios-src');
        if (navigator.xr && navigator.xr.isSessionSupported) {
          // Modern WebXR devices (Android Chrome, iOS 17+ Safari)
          return true;
        }
        // Fallbacks: Android Scene Viewer or iOS Quick Look (needs USDZ)
        return (!isIOS) || (isIOS && hasUSDZ);
      }
      status.textContent = supportsAR() ? 'AR supported' : 'AR may require a compatible device/browser';

      // Web Share (for quick QR-less sharing)
      const shareBtn = document.getElementById('shareBtn');
      shareBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        const data = { title: document.title, text: 'Open this WebAR scene', url: location.href };
        if (navigator.share) {
          try { await navigator.share(data); } catch {}
        } else {
          prompt('Copy this link:', location.href);
        }
      });
    </script>
  </body>
</html>
